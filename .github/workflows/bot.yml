name: ğŸ¤– Mastodon Simple Bot

on:
  schedule:
    - cron: '*/30 * * * *'
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Pobierz kod z GitHub
      uses: actions/checkout@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}   # â† WAÅ»NE! TO DZIAÅA AUTOMATYCZNIE
    
    - name: ğŸ Ustaw Pythona
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: ğŸ“¦ Zainstaluj biblioteki
      run: pip install Mastodon.py
    
    - name: ğŸ¤– Uruchom bota
      env:
        MASTODON_ACCESS_TOKEN: ${{ secrets.MASTODON_ACCESS_TOKEN }}
        MASTODON_BASE_URL: ${{ secrets.MASTODON_BASE_URL }}
      run: |
        echo "=== START BOTA ==="
        python bot.py
        echo "=== KONIEC BOTA ==="
    
    - name: ğŸ’¾ Zapisz zmiany w GitHub
      run: |
        echo "=== ZAPISUJÄ˜ ZMIANY ==="
        
        # 1. Powiedz git kto jesteÅ›
        git config --global user.name "GitHub Actions Bot"
        git config --global user.email "actions@github.com"
        
        # 2. Dodaj pliki ktÃ³re zmieniÅ‚ bot
        git add counter.txt used_sentences.json posted_toots.json
        
        # 3. SprawdÅº czy sÄ… zmiany
        if git diff --staged --quiet; then
          echo "ğŸ“­ Brak zmian"
        else
          echo "âœ… SÄ… zmiany - zapisujÄ™..."
          
          # 4. ZrÃ³b commit
          git commit -m "ğŸ¤– Bot: $(date '+%H:%M')"
          
          # 5. WyÅ›lij do GitHub
          git push
          
          echo "ğŸ‰ Wszystko zapisane w GitHub!"
        fi
    
    - name: âœ… Gotowe
      run: |
        echo ""
        echo "=== ğŸ¤– BOT WYKONANY ==="
        echo "Czas: $(date '+%H:%M:%S')"
        echo "NastÄ™pne uruchomienie: za 30 minut"
        echo ""
        echo "ğŸ“Š Co zrobiÅ‚ bot:"
        [ -f "counter.txt" ] && echo "Licznik: $(cat counter.txt)"
        echo "========================"
