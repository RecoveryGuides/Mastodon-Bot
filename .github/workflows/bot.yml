name: ğŸ¤– Mastodon Simple Bot

on:
  schedule:
    # Uruchamiaj co 30 minut, 24/7
    - cron: '*/30 * * * *'
  
  workflow_dispatch:

concurrency:
  group: mastodon-simple-${{ github.ref }}
  cancel-in-progress: true

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
    - name: ğŸ“¥ Pobierz kod
      uses: actions/checkout@v3
    
    - name: ğŸ Ustaw Pythona
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: ğŸ“¦ Zainstaluj zaleÅ¼noÅ›ci
      run: pip install Mastodon.py==1.8.1
    
    - name: ğŸ“ StwÃ³rz pliki jeÅ›li brakuje
      run: |
        # Plik sentencji jeÅ›li nie istnieje
        if [ ! -f "sentences.txt" ]; then
          echo "TworzÄ™ sentences.txt..."
          cat > sentences.txt << 'EOF'
When you're broke, track every dollar. It adds up fast.
Call hospital billing TODAY for payment plans.
Food banks exist for a reason. Use them without shame.
Sell plasma - immediate cash when you have nothing.
Cancel ALL subscriptions. Netflix won't feed you.
Rice and beans = $0.50 per meal. Learn to cook them.
Call 211 for emergency help with bills and food.
Your library has free internet, AC, and job resources.
Apply for SNAP benefits online - takes 20 minutes.
Avoid payday loans at ALL costs. 400% interest kills.
Walk or bike everywhere. Cancel car insurance if needed.
Collect aluminum cans. Honest money when desperate.
Learn basic handyman skills. Offer services on Craigslist.
Check church bulletin boards for odd jobs paying cash.
Use food pantry finder: feedingamerica.org/find-food
Medicaid expansion saved millions. Check your eligibility.
Section 8 waiting lists are long. Apply TODAY anyway.
Learn about "adverse possession" laws in your state.
Homeless shelters often have job placement resources.
Sell old clothes on Poshmark. Every $5 helps.
EOF
        fi
        
        # Plik uÅ¼ytych sentencji
        if [ ! -f "used_sentences.json" ]; then
          echo '{"used": [], "reset_date": "2000-01-01"}' > used_sentences.json
        fi
        
        # Licznik
        if [ ! -f "counter.txt" ]; then
          echo "0" > counter.txt
        fi
    
    - name: ğŸ¤– Uruchom bota
      env:
        MASTODON_ACCESS_TOKEN: ${{ secrets.MASTODON_ACCESS_TOKEN }}
        MASTODON_BASE_URL: ${{ secrets.MASTODON_BASE_URL }}
      run: python bot.py
    
    - name: ğŸ’¾ Zapisz zmiany
      if: always()
      run: |
        git config --global user.email "bot@github.com"
        git config --global user.name "GitHub Bot"
        
        git add used_sentences.json counter.txt 2>/dev/null || true
        
        if git diff --staged --quiet; then
          echo "ğŸ“­ Brak zmian"
        else
          git commit -m "ğŸ¤– Update $(date -u +'%H:%M')"
          git push
          echo "âœ… Zmiany zapisane"
        fi
