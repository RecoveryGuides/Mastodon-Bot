name: ü§ñ Mastodon Simple Bot (Safe)

on:
  schedule:
    # Dwa razy dziennie o r√≥≈ºnych porach
    - cron: '0 10 * * *'   # ~10:00 (pierwszy post)
    - cron: '0 18 * * *'   # ~18:00 (drugi post)
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - name: üì• Pobierz kod
      uses: actions/checkout@v3
    
    - name: üé≤ Losowe op√≥≈∫nienie
      id: delay
      run: |
        # Losowe op√≥≈∫nienie 0-90 minut
        DELAY=$(( RANDOM % 5400 ))
        echo "delay=$DELAY" >> $GITHUB_OUTPUT
        echo "‚è±Ô∏è Losowe op√≥≈∫nienie: $(($DELAY/60)) minut"
    
    - name: ‚è≥ Poczekaj losowy czas
      run: sleep ${{ steps.delay.outputs.delay }}
    
    - name: üêç Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: üì¶ Instaluj
      run: pip install Mastodon.py
    
    - name: ü§ñ Uruchom bota
      env:
        MASTODON_ACCESS_TOKEN: ${{ secrets.MASTODON_ACCESS_TOKEN }}
        MASTODON_BASE_URL: ${{ secrets.MASTODON_BASE_URL }}
      run: python bot.py
    
    - name: üíæ Wy≈õlij zmiany
      run: |
        git config user.name "GitHub Actions"
        git config user.email "actions@github.com"
        
        git add counter.txt used_sentences.json posted_toots.json
        git commit -m "ü§ñ $(date)" || exit 0
        git push
